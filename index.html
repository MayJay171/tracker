<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocol 75: INTELLECT</title>
    <style>
        /* INTELLIGENCE THEME */
        :root {
            --bg-color: #050a10;
            --panel-bg: #0a1520;
            --text-primary: #a8b2d1;
            --accent: #64ffda; /* Neon Cyan */
            --glow: 0 0 10px rgba(100, 255, 218, 0.3);
            --fail: #ff5555;
            --border: 1px solid #1e2d3d;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0;
            background-image: linear-gradient(rgba(10, 21, 32, 0.9), rgba(5, 10, 16, 1));
        }
        .container {
            width: 90%; max-width: 450px; background: var(--panel-bg);
            padding: 2rem; border-radius: 8px; border: var(--border);
            box-shadow: 0 10px 30px -10px rgba(2, 12, 27, 0.7);
            position: relative; overflow: hidden;
        }
        .container::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--accent); box-shadow: var(--glow);
        }
        h1 { font-size: 0.8rem; letter-spacing: 3px; text-align: center; color: var(--accent); text-transform: uppercase; margin-bottom: 0.5rem; opacity: 0.8; }
        .day-counter { font-size: 3.5rem; text-align: center; margin: 0.5rem 0; font-weight: 700; color: #e6f1ff; text-shadow: var(--glow); }
        .status-msg { text-align: center; color: #8892b0; font-size: 0.8rem; margin-bottom: 2rem; min-height: 20px; font-style: italic; }
        .task-list { list-style: none; padding: 0; }
        .task-item {
            background: rgba(17, 34, 64, 0.5); margin-bottom: 12px; padding: 15px;
            border: 1px solid transparent; border-radius: 4px; display: flex; align-items: center;
            cursor: pointer; transition: all 0.2s ease;
        }
        .task-item:hover { border-color: var(--accent); transform: translateX(5px); background: rgba(17, 34, 64, 0.8); }
        .task-item input {
            appearance: none; width: 18px; height: 18px; border: 2px solid var(--text-primary);
            border-radius: 2px; margin-right: 15px; display: grid; place-content: center; cursor: pointer;
        }
        .task-item input::before {
            content: ""; width: 10px; height: 10px; transform: scale(0);
            background-color: var(--accent); transition: 120ms transform ease-in-out; box-shadow: var(--glow);
        }
        .task-item input:checked { border-color: var(--accent); }
        .task-item input:checked::before { transform: scale(1); }
        .task-text { flex-grow: 1; font-size: 0.9rem; }
        .shake { animation: shake 0.5s; color: var(--fail); text-shadow: none; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
    </style>
</head>
<body>

<div class="container">
    <h1>System Status</h1>
    <div class="day-counter" id="dayDisplay">INIT...</div>
    <div class="status-msg" id="statusMsg">Authenticating secure uplink...</div>

    <ul class="task-list" id="taskList" style="opacity: 0.5; pointer-events: none;">
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Deep Focus (30-45m)</span></li>
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Meta Learning (15m)</span></li>
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Non-Fiction (10+ Pages)</span></li>
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Intellectual Output</span></li>
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Zero Scrolling (Pre-1700)</span></li>
    </ul>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // I HAVE INSERTED YOUR KEYS FROM YOUR SCREENSHOT HERE:
    const firebaseConfig = {
      apiKey: "AIzaSyAEcfXCaXAXA6OJwhTOsJ4kS4PK2kTHT3U",
      authDomain: "my-75-smart-tracker.firebaseapp.com",
      projectId: "my-75-smart-tracker",
      storageBucket: "my-75-smart-tracker.firebasestorage.app",
      messagingSenderId: "410739128536",
      appId: "1:410739128536:web:8416dab4501f27ee42bfad"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const docRef = doc(db, "tracker", "user_data");

    let state = { day: 1, lastDate: new Date().toDateString(), tasks: [false, false, false, false, false] };
    const ui = { day: document.getElementById('dayDisplay'), status: document.getElementById('statusMsg'), checkboxes: document.querySelectorAll('.task-check'), list: document.getElementById('taskList') };

    // 1. Log in silently
    signInAnonymously(auth)
    .then(() => {
        loadData(); // If login works, load data
    })
    .catch((error) => {
        ui.status.innerText = "AUTH FAILED: Enable Anonymous Auth in Firebase Console";
        ui.status.style.color = "#ff5555";
    });

    async function loadData() {
        try {
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) { checkResetLogic(docSnap.data()); } 
            else { await saveData(state); render(); }
            ui.list.style.opacity = "1"; ui.list.style.pointerEvents = "auto";
        } catch (error) { 
            console.error(error); 
            ui.status.innerText = "CONNECTION ERROR."; 
            ui.status.style.color = "#ff5555";
        }
    }

    function checkResetLogic(cloudState) {
        const today = new Date().toDateString();
        if (cloudState.lastDate === today) { state = cloudState; render(); return; }

        const allCompleted = cloudState.tasks.every(t => t === true);
        const diffDays = Math.ceil(Math.abs(new Date(today) - new Date(cloudState.lastDate)) / (86400000)); 

        if (allCompleted && diffDays === 1) {
            state.day = cloudState.day + 1;
            state.tasks = state.tasks.map(() => false);
            ui.status.innerText = "STREAK RETAINED. INCREMENTING.";
        } else {
            state.day = 1;
            state.tasks = state.tasks.map(() => false);
            ui.day.classList.add('shake');
            ui.status.innerText = "PROTOCOL FAILED. RESETTING TO DAY 1.";
            ui.status.style.color = "#ff5555";
        }
        state.lastDate = today;
        saveData(state);
    }

    async function saveData(newState) {
        state = newState; render(); 
        ui.status.innerText = "UPLOADING DATA..."; ui.status.style.color = "#64ffda";
        try {
            await setDoc(docRef, newState);
            ui.status.innerText = "DATA SECURED."; ui.status.style.color = "#64ffda";
        } catch (e) {
            ui.status.innerText = "UPLOAD FAILED."; ui.status.style.color = "#ff5555";
        }
    }

    function render() {
        ui.day.innerText = `DAY ${state.day}`;
        ui.checkboxes.forEach((box, index) => {
            box.checked = state.tasks[index];
            box.onclick = () => {
                state.tasks[index] = box.checked;
                if(state.tasks.every(t => t)) { ui.status.innerText = "OBJECTIVES COMPLETE."; }
                saveData(state);
            };
        });
    }
</script>
</body>
</html>