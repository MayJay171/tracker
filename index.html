<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>75 Smart (Cloud Sync)</title>
    <style>
        :root { --bg-color: #111; --text-color: #eee; --accent: #4caf50; --fail: #f44336; }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .container { width: 90%; max-width: 400px; }
        h1 { font-size: 1.5rem; text-align: center; margin-bottom: 0.5rem; }
        .day-counter { font-size: 4rem; text-align: center; margin: 1rem 0; font-weight: bold; }
        .status-msg { text-align: center; color: #888; margin-bottom: 2rem; font-size: 0.9rem; min-height: 20px;}
        .task-list { list-style: none; padding: 0; }
        .task-item { background: #222; margin-bottom: 10px; padding: 15px; border-radius: 5px; display: flex; align-items: center; cursor: pointer; transition: 0.2s; }
        .task-item:hover { background: #333; }
        .task-item input { margin-right: 15px; transform: scale(1.5); cursor: pointer; }
        .task-text { flex-grow: 1; }
        .shake { animation: shake 0.5s; color: var(--fail); }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 25% { transform: translate(-2px, -2px); } 50% { transform: translate(2px, 2px); } 75% { transform: translate(-1px, -1px); } 100% { transform: translate(0, 0); } }
    </style>
</head>
<body>

<div class="container">
    <h1>75 SMART TRACKER</h1>
    <div class="day-counter" id="dayDisplay">...</div>
    <div class="status-msg" id="statusMsg">Connecting...</div>

    <ul class="task-list" id="taskList" style="opacity: 0.5; pointer-events: none;">
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Deep Focus (30-45m)</span></li>
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Meta Learning (15m)</span></li>
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Non-Fiction (10+ Pages)</span></li>
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">Intellectual Output</span></li>
        <li class="task-item"><input type="checkbox" class="task-check"> <span class="task-text">No Scrolling before 5PM</span></li>
    </ul>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // YOUR FIREBASE CONFIGURATION (From your screenshot)
    const firebaseConfig = {
      apiKey: "AIzaSyDUNSwNzla0SgTtQspZdLGBb0g01dXw0JQ",
      authDomain: "my-75-smart-tracker.firebaseapp.com",
      projectId: "my-75-smart-tracker",
      storageBucket: "my-75-smart-tracker.firebasestorage.app",
      messagingSenderId: "410739128536",
      appId: "1:410739128536:web:8416dab4501f27ee42bfad"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const docRef = doc(db, "tracker", "user_data");

    let state = { day: 1, lastDate: new Date().toDateString(), tasks: [false, false, false, false, false] };
    const ui = { day: document.getElementById('dayDisplay'), status: document.getElementById('statusMsg'), checkboxes: document.querySelectorAll('.task-check'), list: document.getElementById('taskList') };

    async function loadData() {
        try {
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) { checkResetLogic(docSnap.data()); } 
            else { saveData(state); render(); }
            ui.list.style.opacity = "1"; ui.list.style.pointerEvents = "auto";
        } catch (error) { console.error(error); ui.status.innerText = "Connection Failed. Check Console."; }
    }

    function checkResetLogic(cloudState) {
        const today = new Date().toDateString();
        if (cloudState.lastDate === today) { state = cloudState; render(); return; }

        const allCompleted = cloudState.tasks.every(t => t === true);
        const diffDays = Math.ceil(Math.abs(new Date(today) - new Date(cloudState.lastDate)) / (86400000)); 

        if (allCompleted && diffDays === 1) {
            state.day = cloudState.day + 1;
            state.tasks = state.tasks.map(() => false);
            ui.status.innerText = "Streak active.";
        } else {
            state.day = 1;
            state.tasks = state.tasks.map(() => false);
            ui.day.classList.add('shake');
            ui.status.innerText = "Reset to Day 1.";
            ui.status.style.color = "#f44336";
        }
        state.lastDate = today;
        saveData(state);
    }

    async function saveData(newState) {
        state = newState; render(); await setDoc(docRef, newState);
    }

    function render() {
        ui.day.innerText = `DAY ${state.day}`;
        ui.checkboxes.forEach((box, index) => {
            box.checked = state.tasks[index];
            box.onclick = () => {
                state.tasks[index] = box.checked;
                if(state.tasks.every(t => t)) { ui.status.innerText = "Done. Saved."; ui.status.style.color = "#4caf50"; }
                else { ui.status.innerText = "Saving..."; ui.status.style.color = "#888"; }
                saveData(state);
            };
        });
    }
    loadData();
</script>
</body>
</html>